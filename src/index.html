<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
	<title>Stencil Component Starter</title>
	<script src="/build/webaudio.js"></script>

</head>
<body>

	<web-audio-visualizer for="rave" type="webgl">
		<web-audio-visualizer-shader type="vertex">
			attribute vec2 position;

			void main(void) {
				gl_Position = vec4(position, 0, 1);
			}
		</web-audio-visualizer-shader>
		<web-audio-visualizer-shader type="fragment">
			precision mediump float;

			uniform float time;
			uniform vec2 resolution;
			uniform sampler2D spectrum;

			void main(void) {
			  vec3 c;
			  float z = 0.1 * time;
			  vec2 uv = gl_FragCoord.xy / resolution;
			  vec2 p = uv - 0.5;
			  p.x *= resolution.x / resolution.y;
			  float l = 0.2 * length(p);
			  for (int i = 0; i < 3; i++) {
			    z += 0.07;
			    uv += p / l * (sin(z) + 1.0) * abs(sin(l * 9.0 - z * 2.0));
			    c[i] = 0.01 / length(abs(mod(uv, 1.0) - 0.5));
			  }
			  float intensity = texture2D(spectrum, vec2(l, 0.5)).x;
			  gl_FragColor = vec4(c / l * intensity, time);
			}
		</web-audio-visualizer-shader>
	</web-audio-visualizer>

	<web-audio-sequencer tempo="58.81" name="rave" taps="16"></web-audio-sequencer>

	<web-audio name="rave">
		<web-audio-source name="hum_base" src="https://ui.splitinfinities.com/unbundled/node_modules/@splitinfinities/audio-stems/hum_base.mp3"></web-audio-source>

		<web-audio-effect name="one_effect" type="filter" method="notch" responds="mouse" axis="bi-reverse">
			<web-audio-source name="hum_high" src="https://ui.splitinfinities.com/unbundled/node_modules/@splitinfinities/audio-stems/hum_high.mp3"></web-audio-source>
		</web-audio-effect>

		<web-audio-effect name="two_effect" type="filter" method="lowpass" responds="mouse" axis="y">
			<web-audio-effect name="one_effect" type="filter" method="notch" responds="mouse" axis="x">
				<web-audio-source name="drums_relaxed" src="https://ui.splitinfinities.com/unbundled/node_modules/@splitinfinities/audio-stems/drums_relaxed.mp3"></web-audio-source>
			</web-audio-effect>
		</web-audio-effect>

		<web-audio-effect name="two_effect" type="filter" method="lowpass" responds="mouse" axis="y">
			<web-audio-effect name="one_effect" type="filter" method="notch" responds="mouse" axis="x">
				<web-audio-source name="drums_excited" src="https://ui.splitinfinities.com/unbundled/node_modules/@splitinfinities/audio-stems/drums_excited.mp3"></web-audio-source>
			</web-audio-effect>
		</web-audio-effect>

		<web-audio-effect name="two_effect" type="filter" method="lowpass" responds="mouse" axis="x">
			<web-audio-effect name="one_effect" type="filter" method="notch" responds="mouse" axis="y">
				<web-audio-source name="real_pizzicato" src="https://ui.splitinfinities.com/unbundled/node_modules/@splitinfinities/audio-stems/real_pizzicato.mp3"></web-audio-source>
			</web-audio-effect>
		</web-audio-effect>
	</web-audio>

	<web-audio-debugger></web-audio-debugger>

	<button onclick="webAudioSequencer.play();">play</button>
	<button onclick="webAudioSequencer.stop();">stop</button>

	<script>
		var webAudioSequencer = document.querySelector('web-audio-sequencer[name="rave"]');
		var rave = document.querySelector('web-audio[name="rave"]');

		webAudioSequencer.custom = function () {
			if (rave.is_prepared()) {
					// Start of the beat
					if (this.currentTap === 0) {
						if ((this.iterations % 16) < 8) {
							rave.source("hum_base").play();
							rave.source("drums_relaxed").play();
						} else {
							rave.source("hum_base").play();
							rave.source("hum_high").play();
							rave.source("drums_excited").play();
							rave.source("real_pizzicato").play();
						}
					}
				}
			}
		</script>
	</body>
</html>
